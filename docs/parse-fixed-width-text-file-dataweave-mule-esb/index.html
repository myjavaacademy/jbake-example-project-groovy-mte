<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>My {Java} Academy</title>
        <link rel="shortcut" href="/icons/myJ.png"/>
        <link rel="shortcut icon" href="/icons/myJ.png"/>
        <meta property="og:locale" content="en_US"/>
        <meta property="og:type" content="website"/>
        <meta property="og:title" content="My {Java} Academy - Learn java and related technologies"/>
        <meta property="og:description" content="[Learn Java, Advanced Java, Spring, Mule ESB and other languages through examples.]"/>
        <meta property="og:url" content="/"/>
        <meta property="og:site_name" content="My {Java} Academy"/>
        <meta name="twitter:card" content="summary"/>
        <meta name="twitter:description" content="[Learn Java, Advanced Java, Spring, Mule ESB and other languages through examples.]"/>
        <meta name="twitter:title" content="My {Java} Academy - Learn java and related technologies"/>
        <link rel="stylesheet" href="/css/asciidoctor.css"/>
        <link rel="stylesheet" href="/css/foundation.css"/>
        <link rel="stylesheet" href="/css/social_foundicons.css"/>
        <link rel="stylesheet" href="/css/prettify.css"/>
        <link rel="stylesheet" href="/css/desert.css"/>
        <link rel="stylesheet" href="/css/app.css"/>
        
        <script src="/js/vendor/modernizr.js"></script>
        <script src="/js/app.js"></script>
        
    </head><body class="antialiased" onload="prettyPrint();">
<div class="row">
<div class="small-12 large-12 middle-12 text-right columns">
                <a class='right' style='margin: 5px -10px 5px 0' href='https://www.ebates.com/r/MANIKM12?eeid=28585' onclick='sendEBtoGA();' target='_blank' rel='nofollow'><img src='https://www.ebates.com/referral/2012/global_files/images/ebates_logo.png' alt='Ebates Coupons and Cash Back' height='31' width='171' border='0'/></a>
            </div>            <div class="small-12 large-12 middle-12 small-text-center large-text-center middle-text-center columns">
                <div class="title-box">
                    <div class="title-content">
                        <h1>My {Java} Academy</h1>
                        <p>Learn java and related technologies</p>
                        <p class="title-contact">
                            <a href="https://twitter.com/myjavaacademy">
                                <i class="foundicon-twitter"></i>
                            </a><a href="https://www.facebook.com/myjavaacademy/">
                                <i class="foundicon-facebook"></i>
                            </a><a href="https://github.com/myjavaacademy">
                                <i class="foundicon-github"></i>
                            </a>
                        </p>
                    </div>
                </div><div class="sticky contain-to-grid">
                    <nav class="top-bar" data-topbar="" role="navigation">
                        <ul class="title-area">
                            <li class="name"></li><!--Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone--><li class="toggle-topbar menu-icon">
                                <a href="#">
                                    <span>Menu</span>
                                </a>
                            </li>
                        </ul><section class="top-bar-section">
                            <ul class="left">
                                <li>
                                    <a href="/">Home</a>
                                </li><li>
                                    <a href="/archive.html">Archive</a>
                                </li><li>
                                    <a href="https://manik.magar.me" target="_blank">About</a>
                                </li><li>
                                    <a href="/feed.xml">RSS Subscribe</a>
                                </li>
                            </ul>
                        </section>
                    </nav>
                </div>
            </div>
        </div>        <main>
<div class="row">
                <div class="small-12 middle-12 large-12 columns">
                    <article class="wrap">
                        <header>
                            <div class="row">
                                <div class="small-3 medium-1 large-1 columns">
<div class="termin">
                                        <div class="month">Apr</div>
                                        <div class="date">15</div>
                                        <div class="year">2016</div>
                                    </div>                                    
                                </div><div class="small-9 medium-11 large-11 columns">
                                    <div>
                                        <h2>
                                            <a href="/parse-fixed-width-text-file-dataweave-mule-esb/">Parse Fixed width text file with DataWeave in Mule ESB</a>
                                        </h2><p>
                                            <span>
                                                <a href="/tags/DataWeave.html" class="label">DataWeave</a>
                                            </span><span>
                                                <a href="/tags/Mule-ESB.html" class="label">Mule ESB</a>
                                            </span><a href="/parse-fixed-width-text-file-dataweave-mule-esb/#disqus_thread" class="label">Post comments</a>
                                        </p><hr/>
                                    </div>
                                </div>
                            </div>
                        </header><div class="row">
                            <div class="small-9 small-offset-3 medium-11 medium-offset-1 large-11 large-offset-1 columns">
                                <p>With Mule 3.7.0, a new modeling and transformation language was introduced, DataWeave. This is more powerful than its predecessor DataMapper which is marked as deprecated in Mule 3.7</p>
<p>DataWeave component appears as &#8220;Transform Message&#8221; in Mule Anypoint Studio under Mule Palette. DataWeave in Mule 3.7 supports processing of JSON, Java, CSV, EDI, XML, Pojo etc. One format that was missing in DataWeave support was Fixed Width text format. As per the <a href="http://blogs.mulesoft.com/biz/mule/new-mule-3-8-studio-6-0-beta-releases/" target="_blank">beta release notes of Mule 3.8</a>, DataWeave in Mule 3.8 is going to support fixed width text files. But for many of us, it may not be possible to upgrade Mule server for this.</p>
<h2>So How to Process fixed width text file with DataWeave in Mule 3.7?</h2>
<p>So for those who use Mule 3.7 with DataWeave and still want to process fixed width text files, here is the workaround for it.</p>
<p>Let&#8217;s consider below fixed with sample text file &#8211;</p>
<pre class="brush: plain; title=; notranslate" title="">001MONSTARTWORK
001TUEPROGRESSWORK
001WEDTAKEABREAK
001THURESUMEWORK
001FRIFINISHWORK
001SATCHILLDOWN
001SUNGRABABEER
</pre>
<p><strong>Record definition is &#8211;</strong></p>
<pre>Id - Start Position: 0, length: 3
Day - Start Position: 3, length: 3
Shout - Start Position:6, length: 13</pre>
<p>Here is our sample flow that reads the file from input directory, applies dataweave transformation and writes the generated file to output directory.</p>
<div id="attachment_135" style="width: 322px" class="wp-caption aligncenter">
  <img class="wp-image-135 size-full" src="https://i2.wp.com/www.myjavaacademy.com/wp-content/uploads/2016/04/Mule_DW_FixedWidth_Flow-1.png?resize=312%2C130" alt="Mule_DW_FixedWidth_Flow" srcset="https://i1.wp.com/myjavaacademy.com/wp-content/uploads/2016/04/Mule_DW_FixedWidth_Flow-1.png?w=312&ssl=1 312w, https://i1.wp.com/myjavaacademy.com/wp-content/uploads/2016/04/Mule_DW_FixedWidth_Flow-1.png?resize=300%2C125&ssl=1 300w" sizes="(max-width: 312px) 100vw, 312px" data-recalc-dims="1" />
  
  <p class="wp-caption-text">
    Mule flow to convert fixed width text file to JSON
  </p>
</div>
<p>XML Flow &#8211;</p>
<pre class="brush: xml; title=; notranslate" title="">&lt;flow name="DW-FixedWidth-Processing"&gt;
        &lt;file:inbound-endpoint responseTimeout="10000" doc:name="File" moveToDirectory="output" path="input"/&gt;
        &lt;dw:transform-message doc:name="Transform Message" metadata:id="44c29528-4f2b-4aa6-a454-bf2fe7b8de57"&gt;
            &lt;dw:input-payload doc:sample="string_1.dwl"/&gt;
            &lt;dw:set-payload&gt;&lt;![CDATA[%dw 1.0 %output application/json --- (payload splitBy "\n") map { Id:$[0..2], Day:$[3..5], Shout:trim $[6..18] } ]]&gt;&lt;/dw:set-payload&gt;
        &lt;/dw:transform-message&gt;
        &lt;file:outbound-endpoint path="output" outputPattern="output.txt" responseTimeout="10000" doc:name="File"/&gt;
    &lt;/flow&gt;

</pre>
<p>Let&#8217;s look at the DataWeave code now &#8211;</p>
<pre class="brush: plain; title=; notranslate" title="">%dw 1.0
%output application/json
---
(payload splitBy "\n") map {
	Id:$[0..2],
	Day:$[3..5],
	Shout:$[6..18]
}
</pre>
<p>As our payload is going to be file content i.e. String, we will split the content with new line char &#8220;\n&#8221;. Note the parenthesis used for `payload splitBy &#8220;\n&#8221;` which makes the output of that expression, input for map. Now, we have split our payload by newline so inside map we will be reading each line from our file and can be accessed with default alias $.</p>
<p>As per our record definition, Id field starts at 0 and is of 3 character long. So we map our Id by using <a href="https://docs.mulesoft.com/mule-user-guide/v/3.7/dataweave-reference-documentation#range-selector" target="_blank">Range Selector on String</a> $[0..2] which is $[startIndex..endIndex]. Similarly we can select Day and Shout also.</p>
<p>We have intentionally used &#8220;\n&#8221; instead of &#8220;\r\n&#8221; to make sure our code works on windows as well as UNIX. Note that, for the last field our actual file content ends at 18th position but on windows formatted files, there should be &#8220;\r&#8221; at 19th position. As we will only map until last fixed position, &#8220;\r&#8221; should not be a problem. In case you see carriage returns in output then most probably you have included this last character in your output too.</p>
<p>Now, we have seen how we can split the fields in dataweave. You can actually write any logic on the fields. For example, to avoid any empty spaces in shout field we can use trim function.</p>
<pre class="brush: plain; title=; notranslate" title="">shout: trim $[6:18]

</pre>
<p>Here is our output from above transformation &#8211;</p>
<pre>[
  {
    "Id": "001",
    "Day": "MON",
    "Shout": "STARTWORK"
  },
  {
    "Id": "001",
    "Day": "TUE",
    "Shout": "PROGRESSWORK"
  },
  {
    "Id": "001",
    "Day": "WED",
    "Shout": "TAKEABREAK"
  },
  {
    "Id": "001",
    "Day": "THU",
    "Shout": "RESUMEWORK"
  },
  {
    "Id": "001",
    "Day": "FRI",
    "Shout": "FINISHWORK"
  },
  {
    "Id": "001",
    "Day": "SAT",
    "Shout": "CHILLDOWN"
  },
  {
    "Id": "001",
    "Day": "SUN",
    "Shout": "GRABABEER"
  }
]

</pre>
<p>With this example, we learned how to consume fixed width text file with DataWeave in Mule 3.7.</p>
<p><strong>Next see how to</strong> <a href="http://www.myjavaacademy.com/create-fixed-width-file-dataweave-mule-3-7/">create fixed width flat file using DataWeave in Mule 3.7</a></p>
<p>Feel free to let me know what you think or any questions, I will be happy to help.</p>
                            </div>
                        </div><div class="row">
                            <div class="small-9 small-offset-3 medium-11 medium-offset-1 large-11 large-offset-1 columns">
                                <hr/>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//myjavaacademy.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            </div>
                        </div>
                    </article>
                </div>
            </div>            
        </main>
<yieldUnesacped><script id="dsq-count-scr" src="//myjavaacademy.disqus.com/count.js" async></script></yieldUnesacped><div class="row">
            <div class="small-9 small-offset-3 medium-11 medium-offset-1 large-11 large-offset-1 columns">
                <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75535410-1', 'auto');
  ga('send', 'pageview');

</script>
            </div>
        </div><div class="row">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a> All posts published in this blog are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons by-nc-sa 4.0 International License</a>.
        </div><div class="row">
            <div class="small-12 small-text-center">
                <p class="muted credit">
                    2009 - 2017 | Mixed with <a href="http://foundation.zurb.com/">Foundation v5.5.1</a> | Baked with <a href="http://jbake.org">JBake v2.5.1</a> | <a href="/sitemap.xml">Sitemap</a> | <a href="/terms-and-usage">Terms and Usage Policy</a>
                </p>
            </div>
        </div>        <script src="/js/vendor/jquery.js"></script>
        <script src="/js/foundation.min.js"></script>
        <script src="/js/vendor/prettify.js"></script>
        <script>
            $(document).foundation();
            $(function() {
               hljs.tabReplace = "  ";
               hljs.initHighlighting();
            });
        </script>
        
    </body>
</html>
